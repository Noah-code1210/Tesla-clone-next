import { useEffect, useState } from "react";
import Header from "./header";
import Head from "next/head";
import Menu from "./menu";
import "../styles/index.module.css";
import HeaderBlock from "./headerBlock";
import { login, logout, selectUser } from "../features/userSlice";
import { useDispatch, useSelector } from "react-redux";
import Link from "next/link";
import Tesla from "./Tesla";
import { auth } from '../pages/firebase'

export default function Home() {
  const user = useSelector(selectUser);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const dispatch = useDispatch()

  useEffect(() => {
    auth.onAuthStateChanged((userAuth) => {
      if (userAuth) {
        dispatch(
          login({
            email: userAuth.email,
            uid: userAuth.uid,
            displayName: userAuth.displayName,
          })
        )
      } else {
        dispatch(logout())
      }
    })
  }, [dispatch])

  return (
    <>
      <Head>
        <title>Tesla</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
          rel="icon"
          href="https://img.icons8.com/win10/512/FFFFFF/tesla-logo.png"
        />
      </Head>
      <Header isMenuOpen={isMenuOpen} setIsMenuOpen={setIsMenuOpen} />
      {isMenuOpen && <Menu />}
      <HeaderBlock />
      {
        !user ? (
        <Link href={"/login"} />
      ) : (
        <>
        <Tesla isMenuOpen={isMenuOpen} setIsMenuOpen={setIsMenuOpen}/>
        {isMenuOpen && <Menu />}
        </>
      )
      }
    </>
  );
}
